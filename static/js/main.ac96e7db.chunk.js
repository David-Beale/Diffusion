(this.webpackJsonpdiffusion=this.webpackJsonpdiffusion||[]).push([[0],{38:function(e,r,t){},39:function(e,r,t){},44:function(e,r,t){"use strict";t.r(r);var n=t(5),c=t.n(n),a=t(29),u=t.n(a),s=(t(38),t(9)),o=(t(39),t(14)),i=t(49),f=t(48),l=t(47),j=t(6),d=new Worker("./worker/worker.js"),b=new j.Object3D,h=new j.Color,O=new j.Color("red"),x=new j.Color("aqua"),m=new j.Color("green"),p=t(10);function R(e){var r=e.length,t=e.outerRadius,c=function(e){var r=e.length,t=e.outerRadius,c=Object(n.useRef)(Array.from({length:5},(function(){return{meshRef:Object(n.createRef)(),colorRef:Object(n.createRef)(),colorArray:new Float32Array(r/5*3)}}))),a=Object(n.useRef)(0),u=Object(n.useRef)(),s=Object(n.useRef)(),i=Object(n.useMemo)((function(){return new Float32Array(1560)}),[]),f=Object(n.useRef)(1),l=Object(n.useRef)(0),j=Object(n.useRef)(!1);Object(n.useEffect)((function(){c.current.forEach((function(e,r){e.meshRef.current.count=0===r?1:0})),b.position.set(0,0,0),b.scale.set(1,1,1),b.updateMatrix();var e=c.current[a.current],r=e.meshRef,t=e.colorRef,n=e.colorArray;r.current.setMatrixAt(0,b.matrix),r.current.instanceMatrix.needsUpdate=!0,h.set("red"),h.toArray(n,0),t.current.needsUpdate=!0,d.postMessage({message:"start",maxRange:110})}),[r]);var p=Object(n.useCallback)((function(e,r){var t=e.x,n=e.y,c=e.z;b.position.set(t,n,c),b.scale.set(1,1,1),b.updateMatrix(),u.current.setMatrixAt(l.current,b.matrix),r<65?h.lerpColors(O,x,r/65):(r=Math.min(r,100),h.lerpColors(x,m,(r-65)/35)),h.toArray(i,3*l.current),l.current++}),[i]);Object(n.useEffect)((function(){return d.onmessage=function(e){e.data.forEach((function(e){var r=e.pos,n=e.dist,c=e.maxDist;t.current=c,p(r,n)})),s.current.needsUpdate=!0,u.current.instanceMatrix.needsUpdate=!0,u.current.count=l.current},function(){d.postMessage({message:"finished"})}}),[t,p]);var R=Object(n.useCallback)((function(){for(var e=0,t=16*f.current,n=0,s=3*f.current,o=0;o<l.current;o++){for(var b=c.current[a.current],h=b.meshRef,O=b.colorRef,x=b.colorArray,m=0;m<16;m++)h.current.instanceMatrix.array[t]=u.current.instanceMatrix.array[e],e++,t++;for(var p=0;p<3;p++)x[s]=i[n],n++,s++;if(f.current++,f.current===r/5&&(a.current++,O.current.needsUpdate=!0,h.current.instanceMatrix.needsUpdate=!0,h.current.count=f.current,f.current=0,t=0,s=0,5===a.current))return j.current=!0,void d.postMessage({message:"finished"})}var R=c.current[a.current],g=R.meshRef;R.colorRef.current.needsUpdate=!0,g.current.instanceMatrix.needsUpdate=!0,g.current.count=f.current,l.current=0}),[i,r]);return Object(o.d)((function(){j.current||(l.current>=500&&R(),d.postMessage({message:"ping"}))})),[c,u,s,i]}({length:r,outerRadius:t}),a=Object(s.a)(c,4),u=a[0],i=a[1],f=a[2],l=a[3];return Object(p.jsxs)(p.Fragment,{children:[u.current.map((function(e,t){var n=e.meshRef,c=e.colorRef,a=e.colorArray;return Object(p.jsxs)("instancedMesh",{ref:n,args:[null,null,r/u.current.length],frustumCulled:!1,children:[Object(p.jsx)("sphereBufferGeometry",{args:[1,16,16],children:Object(p.jsx)("instancedBufferAttribute",{ref:c,attachObject:["attributes","color"],args:[a,3]})}),Object(p.jsx)("meshStandardMaterial",{attach:"material",vertexColors:j.VertexColors})]},t)})),Object(p.jsxs)("instancedMesh",{ref:i,args:[null,null,520],frustumCulled:!1,children:[Object(p.jsx)("sphereBufferGeometry",{args:[1,16,16],children:Object(p.jsx)("instancedBufferAttribute",{ref:f,attachObject:["attributes","color"],args:[l,3]})}),Object(p.jsx)("meshStandardMaterial",{attach:"material",vertexColors:j.VertexColors})]})]})}var g=new j.Vector3;function M(e){var r=e.mouse,t=e.outerRadius,c=Object(n.useRef)(0),a=Object(n.useRef)(.5*Math.PI),u=Object(n.useRef)(100),s=Object(o.e)().camera;return Object(o.d)((function(){var e=2*r.current[0]*Math.PI,n=r.current[1]*Math.PI,o=r.current[2]||Math.max(4*t.current,100),i=c.current+.005*(e-c.current),f=a.current+.005*(n-a.current),l=r.current[2]?.1:.001,j=u.current+l*(o-u.current);g.setFromSphericalCoords(j,f,i),s.position.x=g.x,s.position.y=g.y,s.position.z=g.z,s.lookAt(0,0,0),c.current=i,a.current=f,u.current=j})),null}var v=t(33);function y(){var e=Object(n.useState)(5e4),r=Object(s.a)(e,2),t=r[0],c=(r[1],Object(v.useRef)(4)),a=function(e){var r=Object(n.useRef)([0,.5,null]);return[r,function(e){r.current[0]=e.clientX/window.innerWidth-.5,r.current[1]=e.clientY/window.innerHeight},function(t){if(r.current[2]||(r.current[2]=Math.max(4*e.current,100)),t.deltaY<0){if(r.current[2]<50)return;r.current[2]*=.8}else{if(r.current[2]>1e3)return;r.current[2]*=1.25}}]}(c),u=Object(s.a)(a,3),j=u[0],d=u[1],b=u[2];return Object(p.jsx)("div",{className:"container",onPointerMove:d,onWheel:b,children:Object(p.jsxs)(o.a,{camera:{position:[0,0,100],fov:40,far:1e5},children:[Object(p.jsx)(i.a,{className:"stats"}),Object(p.jsx)("ambientLight",{intensity:.5}),Object(p.jsx)("directionalLight",{intensity:1,position:[-20,20,0]}),Object(p.jsx)("directionalLight",{intensity:.5,position:[20,20,0]}),Object(p.jsx)(R,{length:t,outerRadius:c}),Object(p.jsx)(M,{mouse:j,outerRadius:c}),Object(p.jsx)(f.a,{position:[0,1,0],mieCoefficient:.001,inclination:1,azimuth:0,rayleigh:.01,distance:1e4}),Object(p.jsx)(l.a,{radius:1e4,count:1e3,factor:500,fade:!0})]})})}u.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(y,{})}),document.getElementById("root"))}},[[44,1,2]]]);
//# sourceMappingURL=main.ac96e7db.chunk.js.map